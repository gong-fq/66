<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è¯­æ³•AIåŠ©æ•™ - é¾šå‡¤ä¹¾è€å¸ˆ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ä¿ç•™æ‚¨åŸæœ‰çš„æ‰€æœ‰ç²¾ç¾æ ·å¼ */
        :root {
            --primary: #2c5282; --primary-light: #4a90c7; --accent: #e07a5f;
            --bg-light: #f8f9fa; --bg-white: #ffffff; --text-dark: #1a202c;
            --text-medium: #4a5568; --text-light: #718096; --border: #e2e8f0;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08); --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans SC', 'Crimson Pro', serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; color: var(--text-dark); }
        .container { max-width: 900px; margin: 0 auto; background: var(--bg-white); border-radius: 24px; box-shadow: var(--shadow-lg); overflow: hidden; animation: slideUp 0.6s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: 32px; text-align: center; position: relative; overflow: hidden; }
        .header h1 { font-family: 'Crimson Pro', serif; font-size: 2.2em; font-weight: 700; margin-bottom: 8px; position: relative; z-index: 1; }
        .header p { font-size: 1em; opacity: 0.95; position: relative; z-index: 1; }
        .tabs { display: flex; background: var(--bg-light); border-bottom: 2px solid var(--border); }
        .tab { flex: 1; padding: 18px; background: none; border: none; font-size: 1em; font-weight: 500; color: var(--text-medium); cursor: pointer; transition: all 0.3s; }
        .tab.active { color: var(--primary); background: var(--bg-white); position: relative; }
        .tab.active::after { content: ''; position: absolute; bottom: -2px; left: 0; right: 0; height: 2px; background: var(--primary); }
        .content { padding: 32px; }
        .input-section { display: none; }
        .input-section.active { display: block; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        textarea { width: 100%; padding: 16px; border: 2px solid var(--border); border-radius: 12px; font-size: 1em; min-height: 120px; transition: 0.3s; }
        textarea:focus { outline: none; border-color: var(--primary); }
        .quick-tags { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 12px; }
        .quick-tag { padding: 8px 16px; background: var(--bg-light); border: 1px solid var(--border); border-radius: 20px; font-size: 0.9em; cursor: pointer; transition: 0.3s; }
        .quick-tag:hover { background: var(--primary); color: white; }
        .chat-container { border: 2px solid var(--border); border-radius: 12px; max-height: 500px; overflow-y: auto; padding: 20px; margin-bottom: 24px; background: var(--bg-light); }
        .message { margin-bottom: 20px; }
        .message-content { background: white; padding: 16px; border-radius: 12px; line-height: 1.7; box-shadow: var(--shadow-sm); }
        .user-message .message-content { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn { padding: 14px 24px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .voice-section { text-align: center; padding: 30px; }
        .voice-button { width: 100px; height: 100px; border-radius: 50%; background: var(--accent); border: none; cursor: pointer; }
        .voice-button.active { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ è‹±è¯­è¯­æ³•AIåŠ©æ•™</h1>
            <p>é¾šå‡¤ä¹¾è€å¸ˆçš„æ™ºèƒ½å­¦ä¹ å¹³å° | ä¸“ä¸šÂ·ç²¾å‡†Â·é«˜æ•ˆ</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('text')">ğŸ’¬ æ–‡å­—äº¤æµ</button>
            <button class="tab" onclick="switchTab('voice')">ğŸ¤ è¯­éŸ³å¯¹è¯</button>
        </div>

        <div class="content">
            <div id="textSection" class="input-section active">
                <textarea id="textInput" placeholder="è¾“å…¥è¯­æ³•é—®é¢˜ï¼Œä¾‹å¦‚ï¼šè¯·è§£é‡Šè™šæ‹Ÿè¯­æ°”..."></textarea>
                <div class="quick-tags">
                    <span class="quick-tag" onclick="insertText('è¯·åˆ†æè¿™ä¸ªå¥å­çš„è¯­æ³•ç»“æ„')">å¥å­åˆ†æ</span>
                    <span class="quick-tag" onclick="insertText('è¯·çº æ­£è¿™ä¸ªå¥å­çš„è¯­æ³•é”™è¯¯')">è¯­æ³•çº é”™</span>
                </div>
                <div class="chat-container" id="chatContainer"></div>
                <button class="btn btn-primary" onclick="sendMessage()" id="sendBtn">ğŸ“¤ å‘é€é—®é¢˜</button>
            </div>

            <div id="voiceSection" class="input-section">
                <div class="voice-section">
                    <button class="voice-button" id="voiceBtn" onclick="toggleVoiceRecording()">ğŸ¤</button>
                    <div id="voiceStatus" style="margin-top:10px;">ç‚¹å‡»éº¦å…‹é£å¼€å§‹å½•éŸ³</div>
                </div>
                <div class="chat-container" id="voiceChatContainer"></div>
            </div>
        </div>
    </div>

    <script>
        let conversationHistory = [];
        let recognition = null;
        let isRecording = false;

        // åˆå§‹åŒ–è¯­éŸ³
        if ('webkitSpeechRecognition' icn window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'zh-CN';
            recognition.onresult = (e) => sendVoiceMessage(e.results[0][0].transcript);
            recognition.onend = () => { isRecording = false; document.getElementById('voiceBtn').classList.remove('active'); };
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.input-section').forEach(s => s.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab + 'Section').classList.add('active');
        }

        function insertText(text) { document.getElementById('textInput').value = text; }

        async function sendMessage() {
            const input = document.getElementById('textInput');
            const msg = input.value.trim();
            if (!msg) return;

            addMessage('user', msg, 'chatContainer');
            input.value = '';
            conversationHistory.push({ role: 'user', content: msg });

            try {
                const response = await callDeepSeekAPI(conversationHistory);
                addMessage('ai', response, 'chatContainer');
                conversationHistory.push({ role: 'assistant', content: response });
            } catch (e) {
                addMessage('ai', 'æŠ±æ­‰ï¼Œè¿æ¥å¤±è´¥ã€‚é”™è¯¯ï¼š' + e.message, 'chatContainer');
            }
        }

        async function sendVoiceMessage(msg) {
            addMessage('user', msg, 'voiceChatContainer');
            try {
                const res = await callDeepSeekAPI([{ role: 'user', content: msg }]);
                addMessage('ai', res, 'voiceChatContainer');
                const utter = new SpeechSynthesisUtterance(res);
                window.speechSynthesis.speak(utter);
            } catch (e) { addMessage('ai', 'è¯­éŸ³å¤„ç†å¤±è´¥', 'voiceChatContainer'); }
        }

        // æ ¸å¿ƒç”Ÿäº§ç¯å¢ƒè°ƒç”¨å‡½æ•°
        async function callDeepSeekAPI(messages) {
            const systemPrompt = "ä½ æ˜¯é¾šå‡¤ä¹¾è€å¸ˆçš„AIåŠ©æ•™ï¼Œè‹±è¯­è¯­æ³•ä¸“å®¶ã€‚è¯·ç”¨ä¸“ä¸šã€äº²åˆ‡çš„è¯­æ°”å›ç­”é—®é¢˜ã€‚";
            
            // æ³¨æ„ï¼šè¿™é‡Œå¿…é¡»è¯·æ±‚ /api/ è·¯å¾„ï¼Œç”± netlify.toml è½¬å‘åˆ° functions
            ('/api/deepseek-proxy', {
                method: 'POST',const response = await fetch('/.netlify/functions/deepseek-proxy', { ... });
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    messages: [{ role: 'system', content: systemPrompt }, ...messages]
                })
            });

            if (!response.ok) throw new Error('ç”Ÿäº§æœåŠ¡å™¨å“åº”å¼‚å¸¸');
            const data = await response.json();
            return data.choices[0].message.content;
        }

        function addMessage(role, text, containerId) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `message ${role}-message`;
            div.innerHTML = `<div class="message-content"><strong>${role==='user'?'å­¦ç”Ÿ':'é¾šè€å¸ˆåŠ©æ•™'}:</strong><br>${text.replace(/\n/g,'<br>')}</div>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function toggleVoiceRecording() {
            if (!recognition) return alert('æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³');
            if (isRecording) { recognition.stop(); } 
            else { 
                isRecording = true; 
                document.getElementById('voiceBtn').classList.add('active');
                recognition.start(); 
            }
        }

        window.onload = () => addMessage('ai', 'ä½ å¥½ï¼æˆ‘æ˜¯é¾šå‡¤ä¹¾è€å¸ˆçš„AIåŠ©æ•™ã€‚è¯·éšæ—¶å‘æˆ‘æé—®ã€‚', 'chatContainer');
    </script>
</body>
</html>